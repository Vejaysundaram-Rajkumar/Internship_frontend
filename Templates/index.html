<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Subtitle Genie</title>
<link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
<script src="{{ url_for('static', filename='index.js') }}"></script>
<!-- Link to Bootstrap CSS -->
<link href=
"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" 
          rel="stylesheet" />
<!-- Link to Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link rel="icon" type="image/x-icon" href="{{fav_icon}}">
</head>
<body>
    <div>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
     </div>
    <nav class="navbar navbar-expand-sm  navbar-light" style="background-color: #ffffff">
        <!-- Navbar content -->
        <a class="navbar-brand  fw-bold" href="/">
            
          <div class="header-logo">
            <img id="header-img" src={{fav_icon}}>
          </div></a>
      </div>
        <button class="navbar-toggler" type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#navbarSupportedContent1"
                aria-controls="navbarSupportedContent1" 
                aria-expanded="false" 
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" 
        id="navbarSupportedContent1">
       <ul class="navbar-nav mr-auto">
           <li class="nav-item">
               <a class="nav-link" href="/"><i class="fas fa-home"></i> Home</a>
           </li>
           <li class="nav-item">
               <a class="nav-link" href="/about" ><i class="fas fa-info-circle"></i>About </a>
           </li>
       </ul>
            
    </nav>

    <div id="messageContainer">
      {% if message == "transcribed" %}
      <div class="alert success" style="background-color:green">
          <span class="closebtn " onclick="this.parentElement.style.display='none';">&times;</span> 
          <strong>Success!</strong> Your video is transcribed and saved successfully.
      </div>
      {% elif message == "fail" %}
      <div class="alert error" style="background-color:red">
          <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
          <strong>Error!</strong> Some error occurred while processing the video.
      </div>
      {% elif error_title == "patherror" %}
      <div class="alert error" style="background-color:red">
          <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
          <strong>Error!!</strong> Provide a correct path to save your file.
      </div>
      {% elif message == "translated" %}
      <div class="alert success" style="background-color:green">
          <span class="closebtn" onclick="this.parentElement.style.display='none';">&times;</span> 
          <strong>Success!</strong> Transcript is Created successfully!
      </div>
      {% endif %}
    </div>
    <div class="container">
      <h1 class="main-heading">Transform Your Videos with Perfect Subtitles!</h1>
      <p class="intro-text">
          Creating subtitles is as easy as a few clicks.Upload your video and let us do the rest. Your  personalized file will be ready in moments!
      </p>
  </div>
    <div class="container2">
        <div class="recent-files">
            <div class="title-bar">
                <h1><i class="fa fa-history" aria-hidden="true"></i> Recent Transcripts</h1>
                <button class="upload-button" onclick="openupload()"> <i class="fa-solid fa-upload"></i> Upload/Transcribe</button>
            </div>
            <div class="file-list">
                {% if uploaded_files %}
                <table class="file-table">
                    <thead>
                        <tr>
                            <th>S.No</th>
                            <th>File Name</th>
                            <th>Download</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for file_path in uploaded_files %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ file_path.split('uploads')[-1].replace('\\', '').replace('.srt', '') }}</td>
                            <td>
                                <a href="{{ url_for('download', file_path=file_path) }}">Download <i class="fa-solid fa-download"></i> </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p>No recent files available!!</p>
                {% endif %}
            </div>
        </div>
        <br>
      <div class="upload-form" id="upload-form">
        <a  id="close" onclick="closeupload()"><i class="fa-solid fa-close"></i></a>
        <h2>Upload Video File</h2>
          <p>Click on the "Choose File" button to upload a video file for processing:</p>
          
          <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data">
              <input type="file" id="myFile" name="file" accept=".mp4,.avi,.mov">
              
              <strong><label for="options" id="op">Translate/Transcribe</label></strong>
              <select name="option" id="options">
                  <option value="translate">Transcribe and Translate</option>
                  <option value="transcribe">Transcribe</option>
              </select>
              
              <!-- Hidden by default using the "hidden" class -->
              <div id="translateOptions" class="hidden">
                  <strong><label for="translateTo" id="op">Translate to:</label></strong>
                  <select name="translateTo" id="translateTo">
                      <option value="ta_IN">Tamil</option>
                      <option value="en_XX">English</option>
                  </select>
              </div>
              <input type="submit" class="form-button" onclick="submitfile()" value="START GENERATING" >
              

          </form>
  
          <div id="errorMessage" class="error-message"></div>
      </div>
  </div>




<div class="loader">
  <div class="loader-content">
  <div class="loader-text" id="loaderMessage">Uploading...</div>
</div>
</div>
<script>
// hides and unhides the translate option dropdown
// Get the relevant elements
const optionSelect = document.getElementById('options');
        const translateOptions = document.getElementById('translateOptions');

        // Function to show or hide the translation options based on selection
        function toggleTranslateOptions() {
            const selectedOption = optionSelect.value;
            if (selectedOption === 'translate') {
                translateOptions.classList.remove('hidden');
            } else {
                translateOptions.classList.add('hidden');
            }
        }

        // Add event listener to call toggleTranslateOptions on change
        optionSelect.addEventListener('change', toggleTranslateOptions);

        // Call toggleTranslateOptions initially to set initial state
        toggleTranslateOptions();




  // loder logic start
     function showloader() {
      
      const loader = document.querySelector('.loader');
      loader.classList.remove('loader-hidden');

      // Array of messages to rotate through
    const messages = [
        'Extracting the audio from the given file...',
        'Processing the audio.....',
        'Detecting the language....',
        'Transcribing audio...',
        'Finalizing the transcript content...',
        'Processing model.... dont close this window till the transcription/ translation is done...'
      ];

      let messageIndex = 0;
      const loaderMessage = document.getElementById('loaderMessage');

      // Function to update loader message with next message in array
      function rotateMessages() {
        loaderMessage.textContent = messages[messageIndex];
        messageIndex = (messageIndex + 1) % messages.length; // Cycle through messages
      }

      // Initial rotation
      rotateMessages();


      const messageInterval = setInterval(rotateMessages, 5000);

    }

    



    // Function to hide loader when message is received
    function hideLoader() {
      const loader = document.querySelector('.loader');
      loader.classList.add('loader-hidden');
      console.log("sucess!!!");
      alert("Transcripted video downloaded sucessfully!!");
    }
   
    function submitfile(){
        showloader();
        }
    function openupload() {

  document.querySelector('.upload-button').style.display = 'none';
  document.getElementById('upload-form').style.display = 'block';
  document.querySelector('.title-bar').style.justifyContent = 'center';
    }
    function closeupload() {
  document.querySelector('.upload-button').style.display = 'block';
  document.getElementById('upload-form').style.display = 'none';
  document.querySelector('.title-bar').style.justifyContent = 'space-between';
}


  </script>


<!-- Bootstrap JS bundle  -->
<script 
src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js">
      </script>

</body>
</html>
